---
title: "R_HW_4_PavlovaDN"
author: "Pavlova"
output: html_document
---

### Задание 1 (2 балла) Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

Затем:

Сформулируйте нулевую и альтернативную гипотезы. Определите уровень значимости. Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор. Определите наблюдаемое значение статистики, а также критическое значение статистики. Оцените и прокомментируйте статистическую значимость.

```{r}
# используемые библиотеки
library(ggplot2)
library(tidyverse)
library(car)
```

```{r}
# задаем seed
set.seed(30)

# размер выборки
sample_size <- 30.

#Формулировка гипотез:
#H0 - Среднее артериальное давление до приема нового препарата равно среднему давлению после приема.
#Ha - Среднее артериальное давление после приема нового препарата меньше, чем до приема.

# уровень значимости 
# альфа = 0.05

# Генерация данных до и после приема препарата (предположим нормальное распределение)
before <- rnorm(sample_size, mean = 145, sd = 15)  # Среднее до приема = 140
after <- rnorm(sample_size, mean = 130, sd = 15)   # Среднее после приема = 130

# Визуальная проверка распределения
par(mfrow = c(2, 2))  # Расположение графиков в виде матрицы 2x2

# Гистограммы для обеих выборок
hist(before, main = "До приема препарата", xlab = "Артериальное давление")
hist(after, main = "После приема препарата", xlab = "Артериальное давление")

# QQ-графики для обеих выборок
qqnorm(before, main = "QQ-график для данных до приема препарата")
qqline(before)
qqnorm(after, main = "QQ-график для данных после приема препарата")
qqline(after)

# Тест Шапиро-Уилка
shapiro_test_before <- shapiro.test(before)
shapiro_test_after <- shapiro.test(after)

# Вывод результатов теста Шапиро-Уилка
print("Тест Шапиро-Уилка для данных до приема препарата:")
print(shapiro_test_before)
print("Тест Шапиро-Уилка для данных после приема препарата:")
print(shapiro_test_after)


```

визуально и с помощью теста Шапиро-Уилка распределение можно оценить как нормальное

```{r}
# так как у нас связанные выборки (измерения до и после введения препарата), мы можем использовать t-тест для связанных выборок (paired t-test)


# Проведение t-теста для связанных выборок
t_test_result <- t.test(before, after, paired = TRUE, alternative = "less")

# Вывод результатов
print(t_test_result)
```

p-значение (0.9961) значительно больше уровня значимости альфа=0.05

```{r}
# Расчет критического значения для нормального распределения
alpha <- 0.05
critical_value <- qt(1 - alpha/2, df = 29)

# Вывод критического значения
cat("Критическое значение t-статистики для df = 29 и alpha = 0.05:", critical_value, "\n")

# Оценка статистической значимости
p_value <- 1.531e-08
cat("p-значение:", p_value, "\n")

if (p_value < alpha) {
  cat("p-значение меньше уровня значимости, поэтому мы отвергаем нулевую гипотезу и принимаем альтернативную гипотезу.\n")
  cat("Таким образом, существует статистически значимая разница между артериальным давлением до и после приема препарата.\n")
} else {
  cat("p-значение больше уровня значимости, поэтому мы не можем отвергнуть нулевую гипотезу о равенстве средних значений.\n")
}

# 95% доверительный интервал
confidence_interval <- c(13.42, 23.05)
cat("95% доверительный интервал для разности средних значений двух выборок:", confidence_interval, "\n")

# Вывод оценки средней разницы и наблюдаемого значения t-статистики
mean_difference <- 18.23
observed_t_statistic <- 7.75
cat("Средняя разница:", mean_difference, "\n")
cat("Наблюдаемое значение t-статистики:", observed_t_statistic, "\n")

# Дополнительные комментарии
if (mean_difference > 0 && confidence_interval[1] > 0 && confidence_interval[2] > 0) {
  cat("95% доверительный интервал не включает ноль, что подтверждает статистическую значимость различий.\n")
} else {
  cat("95% доверительный интервал включает ноль, что не позволяет делать однозначные выводы о различиях.\n")
}

```

согласно полученным данным существует статистическая значимость между артериальным давлением до и после приема препарата, то есть мы отвергаем нулевую гипотезу.

### Задание 2 (2 балла) Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 \<- 100 и выборки sample_size2 \<- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

Затем:

Сформулируйте нулевую и альтернативную гипотезы. Определите уровень значимости. Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор. Определите наблюдаемое значение статистики, а также критическое значение статистики. Оцените и прокомментируйте статистическую значимость.

```{r}
# формулируем гипотезы
# H0 - вероятность развития рака легких у курящих статистически не значима
# Ha - вероятность развития рака легких у курящих статистически значима
```

```{r}
# Установка seed для воспроизводимости результатов
set.seed(35)

# Задаем размеры выборок
sample_size1 <- 100
sample_size2 <- 30

# уровень значимости альфа будет равен 0.05

```

```{r}
# Задание параметров
prob_smoking <- 0.8
prob_non_smoking <- 0.2

# Случай 1: Выборка размером 100
sample_size1 <- 100

# Создаем вектор курящих (1) и некурящих (0)
smoking_status1 <- rep(c(1, 0), each = (sample_size1 / 2))

# Генерируем данные для рака легких с заданной вероятностью
set.seed(13) 
cancer_and_smoker1 <- rbinom((sample_size1 / 2), 1, prob_smoking)
cancer_and_nonsmoker1 <- rbinom((sample_size1 / 2), 1, prob_non_smoking)

# Объединяем данные рака легких для курящих и некурящих
lung_cancer1 <- c(cancer_and_smoker1, cancer_and_nonsmoker1)

# Создаем фрейм данных
sample100 <- data.frame(Smoking = smoking_status1, LungCancer = lung_cancer1)

# Посмотрим распределение переменной Smoking для первой выборки
table(sample100$Smoking)

# Случай 2: Выборка размером 30
sample_size2 <- 30

# Создаем вектор курящих (1) и некурящих (0)
smoking_status2 <- rep(c(1, 0), each = (sample_size2 / 2))

# Генерируем данные для рака легких с заданной вероятностью
set.seed(1) 
cancer_and_smoker2 <- rbinom((sample_size2 / 2), 1, prob_smoking)
cancer_and_nonsmoker2 <- rbinom((sample_size2 / 2), 1, prob_non_smoking)

# Объединяем данные рака легких для курящих и некурящих
lung_cancer2 <- c(cancer_and_smoker2, cancer_and_nonsmoker2)

# Создаем фрейм данных
sample30 <- data.frame(Smoking = smoking_status2, LungCancer = lung_cancer2)

# Посмотрим распределение переменной Smoking для второй выборки
table(sample30$Smoking)

```

```{r}
# Для первой выборки
ggplot(data = sample100, aes(x = factor(Smoking), fill = factor(LungCancer))) +
  geom_bar(position = "fill") +
  labs(title = "Распределение наличия рака легких по курению (Выборка 1)",
       x = "Курение (1 - курящий, 0 - некурящий)",
       y = "Доля от общего числа",
       fill = "Наличие рака легких") +
  scale_fill_manual(values = c("lightblue", "orange"), labels = c("Нет", "Есть")) +
  theme_minimal()

# Для второй выборки
ggplot(data = sample30, aes(x = factor(Smoking), fill = factor(LungCancer))) +
  geom_bar(position = "fill") +
  labs(title = "Распределение наличия рака легких по курению (Выборка 2)",
       x = "Курение (1 - курящий, 0 - некурящий)",
       y = "Доля от общего числа",
       fill = "Наличие рака легких") +
  scale_fill_manual(values = c("lightblue", "orange"), labels = c("Нет", "Есть")) +
  theme_minimal()



```

видим что распределение больных раком легких среди курящих больше в обоих выборках

Для проверки связи между курением и развитием рака легких в каждой выборке можно использовать тест на независимость двух категориальных переменных. В данном случае подходящим тестом будет хи-квадрат тест. Этот тест позволит нам оценить, существует ли статистически значимая связь между курением и наличием рака легких в каждой выборке.

```{r}
# Проведение теста Хи-квадрат для первой выборки
result1 <- chisq.test(table(sample100$Smoking, sample100$LungCancer))
print(result1)

# Проведение теста Хи-квадрат для второй выборки
result2 <- chisq.test(table(sample30$Smoking, sample30$LungCancer))
print(result2)

```

```{r}
# Наблюдаемые значения статистики
observed_statistic1 <- result1$statistic
observed_statistic2 <- result2$statistic

# Критические значения статистики
critical_value1 <- qchisq(0.95, df = result1$parameter)
critical_value2 <- qchisq(0.95, df = result2$parameter)

# Вывод результатов
cat("Наблюдаемое значение статистики (выборка 1):", observed_statistic1, "\n")
cat("Критическое значение статистики (выборка 1):", critical_value1, "\n")
cat("\n")
cat("Наблюдаемое значение статистики (выборка 2):", observed_statistic2, "\n")
cat("Критическое значение статистики (выборка 2):", critical_value2, "\n")

```

В обоих случаях наблюдаемое значение статистики Хи-квадрат существенно превышает критическое значение для уровня значимости 0.05, что указывает на статистически значимую связь между курением и развитием рака легких в обеих выборках.

Таким образом, на основе результатов теста мы можем отвергнуть нулевую гипотезу о том, что курение и развитие рака легких независимы, и сделать вывод о наличии статистически значимой связи между этими переменными в обеих выборках.

### Задание 3 (3 балла) Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

Что нужно сделать:

Сформулируйте нулевую и альтернативную гипотезы. Определите уровень значимости. Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор. Определите наблюдаемое значение статистики, а также критическое значение статистики. Оцените и прокомментируйте статистическую значимость.

Сформулируем гипотезы: H0 - Применение нового метода лечения синдрома раздраженного кишечника не оказывает значимого влияния на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией. Hа - Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

```{r}
# Для данного анализа мы можем выбрали уровень значимости α = 0.05.
```

```{r}
# Задание параметров
sample_size1 <- 90
sample_size2 <- 90

# Генерация данных
set.seed(120) # для воспроизводимости результатов
pain_level_treatment1 <- rnorm(sample_size1, mean = 5, sd = 2) # Для группы с новым методом лечения
pain_level_treatment2 <- rnorm(sample_size2, mean = 7, sd = 2) # Для группы с диетотерапией

# Проверка распределения данных
hist(pain_level_treatment1, main = "Распределение уровня болевых симптомов (группа 1)", xlab = "Уровень боли", col = "skyblue", border = "white")
hist(pain_level_treatment2, main = "Распределение уровня болевых симптомов (группа 2)", xlab = "Уровень боли", col = "lightgreen", border = "white")
# визуально распределение нормальное

# теперь дополнительно проведём тест Шапиро-Уилка

shapiro_test_treatment1 <- shapiro.test(pain_level_treatment1)
shapiro_test_treatment2 <- shapiro.test(pain_level_treatment2)

# Вывод результатов теста Шапиро-Уилка
print("Результаты теста Шапиро-Уилка для группы 1:")
print(shapiro_test_treatment1)
print("Результаты теста Шапиро-Уилка для группы 2:")
print(shapiro_test_treatment2)




```

```{r}
#В данном случае мы имеем две независимые выборки и интересует влияние одной категориальной переменной (метод лечения) на количественную переменную (уровень болевых симптомов)  при нормальном распределении. Поэтому самым подходящим тестом будет двухвыборочный t-тест для независимых выборок.

# Проведение t-теста
t_test_result <- t.test(pain_level_treatment1, pain_level_treatment2)

# Вывод результатов
t_test_result
```

p-value значительно меньше уровня значимости. Таким образом, мы можем сделать вывод о том, что есть статистически значимое различие между уровнями болевых симптомов для двух групп. Следовательно, мы отвергаем нулевую гипотезу.

### Задание 4 (4 балла) Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей. Оценивается размер опухоли у мыши.

Сгенерируйте датасет следующим образом:

tumor \<- tibble( therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)), value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10)) ) %\>% mutate(therapy = factor(therapy, levels = c("0", "A", "B"))) tumor$value <- tumor$value + rnorm(30, 0, 760) Постройте на одном графике три «ящика с усами» для наглядности.

Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. Прокомментируйте получившийся результат. С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки. Прокомментируйте полученные результаты.

Сформулируем гипотезы:
H0 - нет статистически значимого влиянии терапии на размер опухоли среди трех групп пациентов.
Ha - есть статистически значимое влияние терапии на размер опухоли среди трех групп пациентов.

```{r}

# Создание датасета
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
mutate(therapy = factor(therapy, levels = c("0", "A", "B")))

# Добавление шума к значениям опухолей
tumor$value <- tumor$value + rnorm(30, 0, 760)

# Построение "ящиков с усами" для трех групп
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Размер опухоли в разных группах", x = "Терапия", y = "Размер опухоли") +
  scale_fill_manual(values = c("0" = "grey", "A" = "blue", "B" = "red"))




```
```{r}
# Проверка нормальности распределения остатков
residuals <- resid(model)
shapiro.test(residuals)
# распределение нормальное

```
```{r}
# H0 - дисперсии гомогенны 
# Hа - дисперсии негомогенны 

# Проведение теста Бартлетта предпочтительнее по причине анализа трех групп
bartlett.test(value ~ therapy, data = tumor)
# тест показал гомогенность дисперсий
```


Для анализа различий между тремя и более группами, обычно используется однофакторный дисперсионный анализ (ANOVA). В данном случае он применим, так как мы имеем три группы (три вида терапии).
```{r}
# Дисперсионный анализ
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)

# Проведение попарных сравнений с помощью критерия Тьюки
tukey_result <- TukeyHSD(anova_result)
tukey_result
```
видим наличие статистически значимого различия в трех выборках. Это означает, что средние значения размера опухоли в группах, получивших различные типы терапии, различаются.Следовательно, мы можем отвегнуть нулевую гипотезу.
